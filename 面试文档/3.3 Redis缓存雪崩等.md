## [了解什么是redis雪崩、穿透和击穿？崩溃后的应对措施是什么](https://maimai.cn/article/detail?fid=1729243003&efid=iVHrBrZCZCnemmDJCTZweQ&share_channel=2&webid=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1IjozNTAyNzA1NiwiZmlkIjoxNzI5MjQzMDAzfQ.GxROco8nHVCC-cRbnniZW_syhKApVUmKm80a8ytqfpE&use_rn=1)
### 缓存雪崩
1. 缓存雪崩
   > 1. 缓存的高峰比如可以每秒可以抗住4000个请求，但是高峰突然达到5000+个请求，缓存机器意外发送全崩，缓存挂了，则所有的请求都<font color="red">全部落到数据库</font>，则数据库崩了， 重启数据库，数据库立马又被新的浏览打死，这个就是雪崩
   ![](https://pic4.zhimg.com/80/v2-a04bf2004c3915ed1e02ba67d37745f7_720w.jpg)
   
2. 解决方案
   > 1. 事前： redis高可用， 主从+哨兵， redis cluster, 避免全屏崩溃
   > 2. 事中：本地ehcache 缓存 + hystrix 限流&降级，避免MySQL 被打死
   > 3. 事后： Redis持久化，一旦重启， 自动从磁盘加载数据，快速恢复缓存数据
   ![](https://pic4.zhimg.com/80/v2-44248fa82c81787bc0f5167d114fb853_720w.jpg)
   > 方案： 用户发送一个请求，系统A 收到请求后， 先查本地encache缓存，如果没查找到，再查找Redis,如果两者都没有，再查找数据结果，写入ehchache和Redis
   > 方案2： 限流组件，可用设置每秒的请求数量，有多少能通过组件，剩下没用通过的， 走降级，可用返回一些默认的值或者友情提示，或者空白的值
   > 好处1： 数据库绝对不会死， 限流组件保证了每秒只有多少个请求能通过
   > 好处2：只要数据库不死， 对用户来说， 2/5用户的请求是可用正确处理的
   > 好处3：没用正确处理的用户，只要多点击几次刷新，就可用刷新操作了
### 缓存穿透
1. 缓存穿透
   > 1. 对于系统A，假设每一秒5000请求，其中4000个请求时黑客发起的恶意攻击
   > 2. 黑客发起的4000个攻击， 缓存查找到，就会每次去查找数据库，也查找不到
   > 3. 这种恶意的攻击场景的缓存穿透，会直接将数据库打死
   ![](https://pic2.zhimg.com/80/v2-a97e1f3430df0a4f51726843d6008f2d_720w.jpg)
2. 解决方案：
   > 1. 每次从数据库中只要没查找到数据， 就写一个空值到缓存中去， 
   > 2. 然后设置一个过期时间，这样的话，下次再有相同的Key 来访的时候，再缓存失效前，就直接从缓存中读取数据

### 缓存击穿
1. 缓存击穿：
   > 1. 缓存击穿，就是说某个key 非常热点，访问非常频繁,处于集中式高并发访问的情况
   > 2. 当这个Key在失效的瞬间，大量的请求就击穿了缓存，直达数据库请求，就将数据库给打死了
2. 解决方案：
   > 1. 如缓存的数据基本上不会更新，我们可尝试将改热点数据，设置为<font color="red">永不过期</font>
   > 2. 若缓存的数据更新频繁或者缓存刷新的流程耗时较长的情况下，可以利用<font color="red">定时线程</font>在缓存过期前主动的重新构建缓存或者延后缓存的过期时间，以保证所有的请求能一直访问到对应的缓存。
